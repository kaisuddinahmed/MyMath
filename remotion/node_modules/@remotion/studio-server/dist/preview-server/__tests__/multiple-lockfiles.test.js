"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const bun_test_1 = require("bun:test");
const node_fs_1 = __importDefault(require("node:fs"));
const node_os_1 = __importDefault(require("node:os"));
const node_path_1 = __importDefault(require("node:path"));
const get_package_manager_1 = require("../get-package-manager");
(0, bun_test_1.describe)('getPackageManager multiple lockfiles', () => {
    let tempDir;
    (0, bun_test_1.beforeEach)(() => {
        tempDir = node_fs_1.default.mkdtempSync(node_path_1.default.join(node_os_1.default.tmpdir(), 'remotion-test-'));
    });
    (0, bun_test_1.afterEach)(() => {
        node_fs_1.default.rmSync(tempDir, { recursive: true, force: true });
    });
    (0, bun_test_1.test)('should not throw error when multiple lockfiles are detected', () => {
        node_fs_1.default.writeFileSync(node_path_1.default.join(tempDir, 'package-lock.json'), '{}');
        node_fs_1.default.writeFileSync(node_path_1.default.join(tempDir, 'bun.lock'), '');
        // Should not throw
        const manager = (0, get_package_manager_1.getPackageManager)(tempDir, undefined, 0);
        // Should return one of them (usually the first one in the list, which is npm)
        (0, bun_test_1.expect)(manager).not.toBe('unknown');
        if (typeof manager !== 'string') {
            (0, bun_test_1.expect)(['npm', 'bun']).toContain(manager.manager);
        }
    });
    (0, bun_test_1.test)('should return npm if only package-lock.json exists', () => {
        node_fs_1.default.writeFileSync(node_path_1.default.join(tempDir, 'package-lock.json'), '{}');
        const manager = (0, get_package_manager_1.getPackageManager)(tempDir, undefined, 0);
        if (typeof manager !== 'string') {
            (0, bun_test_1.expect)(manager.manager).toBe('npm');
        }
    });
});
